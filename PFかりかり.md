# CarminePF

## システム要件
 - ユーザーが設定した製品ファインダーの条件で新規追加になった商品を検知してAmazonで自動購入する
 - なお、本要件に書いているのはあくまで概要のため、細かい部分や変数、DB名等は適宜補完、改善してください

## 製品ファインダー
条件にはhttps://api.keepa.com/query?key=YOUR_API_KEY&domain=5&selection=%7B%22sort%22%3A%5B%5B%22current_SALES%22%2C%22asc%22%5D%5D%2C%22productType%22%3A%5B0%2C1%2C2%5D%2C%22perPage%22%3A100%2C%22page%22%3A0%7D
のようなURLを入力する。
このURLの仕様はhttps://keepa.com/#!discuss/t/product-finder/5473

## フロントエンド
### 仕様
 - Chrome拡張機能のサイドパネル
 - 動作中は、バックエンドの/itemsに常時リクエストを送信する
 - 条件、APIキー、閾値、削除期限をstorageに保存する
 - storage保存時、/configに条件、削除期限をpostする
 - サイドパネル起動時、/statusにリクエストを送信し、レスポンスに応じて開始/停止ボタンの表示を切り替える
 - itemsのレスポンスにASINがあれば、その内容を新しいタブで開いて購入手続きを行う。

### 参考
参考拡張機能フォルダの内容をにエラーハンドリング等つけて改善したものを実装してください。

### UI
 - 開始/停止：ボタン
 - 設定保存：ボタン
 - 条件：テキストボックス、半角英数字記号のみ
 - Amazon直販商品であるか：チェックボックス
 - FBA（Amazonフルフィルメント）商品であるか：チェックボックス
 - 星評価の下限：ドロップダウン、0~5まで0.5刻み
 - 評価数の下限：テキストボックス、正の整数のみ
 - 削除期限：テキストボックス、正の整数のみ
 - ログ表示エリア：テキスト


### UIの動作
#### 開始/停止
 - 開始でクリックすると/startへpost、レスポンスが正常なら文字を"停止"に
 - 停止でクリックすると/stopへpost、レスポンスが正常なら文字を"開始"に
 - postのレスポンスが異常ならログ表示エリアにエラーメッセージを表示
 - レスポンス待ち中はクリック不可＆ローダー表示

### 設定保存
 - 各設定値の入力値をstorageに保存する
 - 条件にAPIキーを実装し、/configにpostする
 - postのレスポンスが異常ならログ表示エリアにエラーメッセージを表示
 - レスポンス待ち中はクリック不可＆ローダー表示

### ログ表示エリア
 - ログ表示する
 - 日時を表示する


## バックエンド

### 仕様
 - ローカルホストで動かす（Conoha VPS for Windowsサーバーで動かすことを想定）
 - /startにpostリクエストがあれば1分毎にconfigデータで保存した条件でAPIをコールする
 - レスポンスのIDとDB(ids)のIDを比較し、レスポンスにIDが新規追加されたらDB(ids, items)に追加
 - /stopにpostリクエストあれば/startの動作を停止する
 - /statusにpostリクエストがあれば、動作状態を返す
 - /configにpostリクエストがあればユーザ情報更新&DB(items, ids)クリア&新規登録
 - /itemsにリクエストがあれば、processed_atの値がないitemsを返し、processed_atへ現在日時を設定する
 - itemsのidでprocessed_atに値がない場合、次のAPIコール時にprocessed_atへ現在日時を設定する
 - idの作成日から削除期限が経過したものはDBから削除する

### 参考
参考バックエンド(GASプログラム)の内容を参考にエラーハンドリング等つけて今回の技術要件にマッチしたものをお願いします。

### DB
#### config
 - 条件
 - 削除期限

#### items
 - id
 - 処理日時
 - 作成日時


### 技術スタック
Express + Typescript + Docker + Prisma + MySql
